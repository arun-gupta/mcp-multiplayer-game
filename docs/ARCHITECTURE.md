# ­ЪЈЌ№ИЈ MCP Protocol Architecture

## Overview

This document describes the detailed architecture of the MCP Protocol Tic Tac Toe game, showing how CrewAI agents work together using the Multi-Context Protocol (MCP) for distributed communication.

## Architecture Diagram

```
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ                           MCP Protocol Architecture                              Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў

РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ    РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ    РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ   Scout Agent   Рћѓ    Рћѓ Strategist AgentРћѓ    Рћѓ Executor Agent  Рћѓ
Рћѓ                 Рћѓ    Рћѓ                 Рћѓ    Рћѓ                 Рћѓ
Рћѓ ­Ъцќ CrewAI Agent Рћѓ    Рћѓ ­Ъцќ CrewAI Agent Рћѓ    Рћѓ ­Ъцќ CrewAI Agent Рћѓ
Рћѓ + MCP Server    Рћѓ    Рћѓ + MCP Server    Рћѓ    Рћѓ + MCP Server    Рћѓ
Рћѓ (Port 3001)     Рћѓ    Рћѓ (Port 3002)     Рћѓ    Рћѓ (Port 3003)     Рћѓ
Рћѓ                 Рћѓ    Рћѓ                 Рћѓ    Рћѓ                 Рћѓ
Рћѓ Рђб LLM IntegrationРћѓ    Рћѓ Рђб LLM IntegrationРћѓ    Рћѓ Рђб LLM IntegrationРћѓ
Рћѓ Рђб Memory Mgmt   Рћѓ    Рћѓ Рђб Memory Mgmt   Рћѓ    Рћѓ Рђб Memory Mgmt   Рћѓ
Рћѓ Рђб Tool ExecutionРћѓ    Рћѓ Рђб Tool ExecutionРћѓ    Рћѓ Рђб Tool ExecutionРћѓ
Рћѓ Рђб MCP Endpoints Рћѓ    Рћѓ Рђб MCP Endpoints Рћѓ    Рћѓ Рђб MCP Endpoints Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў    РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў    РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
         Рћѓ                       Рћѓ                       Рћѓ
         Рћѓ MCP Protocol          Рћѓ MCP Protocol          Рћѓ MCP Protocol
         Рћѓ Communication         Рћѓ Communication         Рћѓ Communication
         Рќ╝                       Рќ╝                       Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ                           MCP Game Coordinator                                  Рћѓ
Рћѓ                                                                                 Рћѓ
Рћѓ Рђб Orchestrates agent communication via MCP protocol                            Рћѓ
Рћѓ Рђб Manages game state and agent coordination                                     Рћѓ
Рћѓ Рђб Handles player moves and AI responses                                         Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
         Рћѓ
         Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ                              Game State                                         Рћѓ
Рћѓ                                                                                 Рћѓ
Рћѓ Рђб Tic Tac Toe Board State                                                       Рћѓ
Рћѓ Рђб Player/AI Move Tracking                                                       Рћѓ
Рћѓ Рђб Win/Loss Detection                                                            Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
         Рћѓ
         Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ                            FastAPI Server                                       Рћѓ
Рћѓ                                                                                 Рћѓ
Рћѓ Рђб REST API Endpoints (Port 8000)                                               Рћѓ
Рћѓ Рђб Agent Status & Metrics                                                        Рћѓ
Рћѓ Рђб Game State Management                                                         Рћѓ
Рћѓ Рђб MCP Protocol Logging                                                          Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
         Рћѓ
         Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ                           Streamlit UI                                          Рћѓ
Рћѓ                                                                                 Рћѓ
Рћѓ Рђб Interactive Game Interface (Port 8501)                                       Рћѓ
Рћѓ Рђб Real-time Agent Monitoring                                                   Рћѓ
Рћѓ Рђб MCP Protocol Visualization                                                   Рћѓ
Рћѓ Рђб Performance Analytics                                                         Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
```

## MCP Communication Flow

```
Player Move Рєњ MCP Coordinator Рєњ Scout Agent (MCP) Рєњ Strategist Agent (MCP) Рєњ Executor Agent (MCP) Рєњ Game State Update
     Рћѓ              Рћѓ                    Рћѓ                        Рћѓ                        Рћѓ
     Рћѓ              Рћѓ                    Рћѓ                        Рћѓ                        Рћѓ
     Рќ╝              Рќ╝                    Рќ╝                        Рќ╝                        Рќ╝
РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ  РћїРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћљ
Рћѓ Player  Рћѓ  Рћѓ MCP Game    Рћѓ  Рћѓ Scout MCP   Рћѓ  Рћѓ Strategist  Рћѓ  Рћѓ Executor    Рћѓ  Рћѓ Game State Рћѓ
Рћѓ Input   Рћѓ  Рћѓ Coordinator Рћѓ  Рћѓ Server      Рћѓ  Рћѓ MCP Server  Рћѓ  Рћѓ MCP Server  Рћѓ  Рћѓ Update     Рћѓ
Рћѓ         Рћѓ  Рћѓ             Рћѓ  Рћѓ             Рћѓ  Рћѓ             Рћѓ  Рћѓ             Рћѓ  Рћѓ            Рћѓ
Рћѓ Рђб Click Рћѓ  Рћѓ Рђб Routes    Рћѓ  Рћѓ Рђб Analyzes  Рћѓ  Рћѓ Рђб Creates   Рћѓ  Рћѓ Рђб Executes  Рћѓ  Рћѓ Рђб Board    Рћѓ
Рћѓ Рђб Move  Рћѓ  Рћѓ Рђб Manages   Рћѓ  Рћѓ Рђб Reports   Рћѓ  Рћѓ Рђб Plans     Рћѓ  Рћѓ Рђб Validates Рћѓ  Рћѓ Рђб Status   Рћѓ
Рћѓ         Рћѓ  Рћѓ Рђб CoordinatesРћѓ  Рћѓ Рђб Patterns  Рћѓ  Рћѓ Рђб Strategy  Рћѓ  Рћѓ Рђб Confirms  Рћѓ  Рћѓ Рђб Winner   Рћѓ
РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў  РћћРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћђРћў
```

## How CrewAI + MCP Work Together

**CrewAI** provides the agent framework capabilities:
- **­Ъцќ Agent Intelligence**: LLM integration, memory management, tool execution
- **­ЪДа Cognitive Abilities**: Reasoning, planning, decision-making
- **­ЪЊџ Memory System**: Persistent memory across interactions
- **­ЪћД Tool Integration**: Access to external tools and APIs

**MCP (Multi-Context Protocol)** provides the communication layer:
- **­Ъїљ Distributed Communication**: Agents communicate via standardized MCP protocol
- **­ЪЊА Service Discovery**: Each agent exposes MCP endpoints for interaction
- **­Ъћё Protocol Standardization**: Consistent communication format across agents
- **­ЪЊі Monitoring & Debugging**: MCP Inspector integration for protocol debugging

**Combined Benefits**:
- **­Ъј» Best of Both Worlds**: CrewAI's intelligence + MCP's distributed communication
- **­ЪћД Modularity**: Each agent can be developed and deployed independently
- **­ЪЊѕ Scalability**: Agents can run on different machines via MCP protocol
- **­ЪЏа№ИЈ Debugging**: Rich monitoring and debugging via MCP Inspector

## Component Details

### Scout Agent (Port 3001)
- **Role**: Board analysis and threat detection
- **CrewAI Capabilities**: Pattern recognition, memory of previous games
- **MCP Tools**: `analyze_board`, `detect_threats`, `identify_opportunities`, `get_pattern_analysis`
- **Communication**: Receives board state, returns analysis

### Strategist Agent (Port 3002)
- **Role**: Strategic planning and move recommendation
- **CrewAI Capabilities**: Strategic thinking, long-term planning
- **MCP Tools**: `create_strategy`, `evaluate_position`, `recommend_move`, `assess_win_probability`
- **Communication**: Receives analysis, returns strategy

### Executor Agent (Port 3003)
- **Role**: Move execution and validation
- **CrewAI Capabilities**: Precise execution, validation logic
- **MCP Tools**: `execute_move`, `validate_move`, `update_game_state`, `confirm_execution`
- **Communication**: Receives strategy, executes move

### MCP Game Coordinator
- **Role**: Orchestrates communication between agents
- **Responsibilities**: Routes messages, manages game state, coordinates agent responses
- **Integration**: Connects to all agent MCP servers

### FastAPI Server (Port 8000)
- **Role**: Main application server
- **Endpoints**: Game management, agent status, metrics, MCP logs
- **Integration**: Coordinates with MCP Game Coordinator

### Streamlit UI (Port 8501)
- **Role**: Interactive user interface
- **Features**: Game visualization, agent monitoring, MCP protocol visualization
- **Integration**: Connects to FastAPI server

## Development Workflow

1. **Start Development** - Launch MCP agents and coordinator
2. **Iterative Testing** - Make changes, rebuild, reconnect Inspector
3. **Edge Case Testing** - Test invalid inputs, concurrent operations
4. **Production Monitoring** - Use MCP endpoints for monitoring

## Benefits

### Modularity
- Each agent can be developed and deployed independently
- Agents communicate via standardized MCP protocol
- Easy to add new agents or modify existing ones

### Scalability
- Agents can run on different machines
- Load balancing across multiple agent instances
- Horizontal scaling of agent capabilities

### Flexibility
- Hot-swap agents or models without restarting the entire system
- Runtime configuration changes via MCP endpoints
- Language-agnostic agent development

### Monitoring
- Rich metrics and monitoring via MCP endpoints
- Real-time agent performance tracking
- Comprehensive logging of agent communications

## Next Steps

1. **Implement Real MCP Protocol** - Replace mock implementation with actual MCP library
2. **MCP Inspector Integration** - Connect to MCP Inspector for debugging
3. **Distributed Deployment** - Deploy agents on different machines
4. **Advanced Monitoring** - Enhanced metrics and monitoring
5. **Unit Tests** - Comprehensive testing of MCP endpoints
6. **Documentation** - Complete API documentation
